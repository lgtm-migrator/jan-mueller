import{p as f,h as d}from"./chunks/hooks.module.5832f08c.js";import{o as g}from"./chunks/jsxRuntime.module.380e1cae.js";import"./chunks/preact.module.49fe28cd.js";function w(e){return`eu.yeger.page-views.${e}`}const m={backendUrl:"https://page-views.up.railway.app/api/views",filter:()=>!0,throttle:864e5,trackPopState:!1};function r(e){return{...m,...e}}function h(){if(typeof window>"u"||typeof window.location>"u")return;const e=window.location,t=`${e.host}${e.pathname}`;return t.endsWith("/")?t.substring(0,t.length-1):t}async function a(e={},t){const n=t??h();if(!n)return;const{backendUrl:o,filter:i,throttle:s}=r(e);if(i(n)){if(s&&typeof localStorage<"u"){const c=Date.now(),u=localStorage.getItem(w(n));if(u!==null&&+u+s>c)return;localStorage.setItem(w(n),c.toString())}try{await fetch(`${o}/${n}`,{method:"POST"})}catch{}}}async function y(e={},t){const n=t??h();if(!n)return 0;const{backendUrl:o}=r(e);return+await(await fetch(`${o}/${n}`,{method:"GET"})).text()}let p=!1;function v(e={}){if(typeof window>"u"||typeof history>"u"||p)return;p=!0;const t=r(e);(()=>{const n=history.pushState;history.pushState=function(...o){const i=n.apply(this,o);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),i},t.trackPopState&&window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("locationchange"))})})(),window.addEventListener("locationchange",()=>{a(t)}),a(t)}const l={autoSubmitViews:v,getViews:y,submitView:a},V=()=>{const[e,t]=f(0);return d(()=>{l.submitView().then(()=>l.getViews()).then(t)},[]),g("span",{className:"text-lighter",children:[e," views"]})};export{V as default};
